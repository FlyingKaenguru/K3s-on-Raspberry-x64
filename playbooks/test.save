---
- hosts: pi
  # become = run as sudo
  become: yes

  pre_tasks:
    - name: Test Ping
      ansible.builtin.ping:

  tasks:
    - name: wait for host to return                                                                                                    
     # Now we will run a local 'ansible -m ping' on this host until it returns.                                                       
     # This works with the existing ansible hosts inventory and so any custom ansible_ssh_hosts definitions are being used            
      local_action: shell ansible -u pi -m ping {{ inventory_hostname }}
      register: result                                                                                                                 
      until: result.rc == 0                                                                                                            
      retries: 30                                                                                                                      
      delay: 10                                                                                                                                                                                                                                                       
      vars:
        ansible_become: false

    - name: debug
      shell: uptime
      register: uptime

    - debug:
        var: uptime.start
